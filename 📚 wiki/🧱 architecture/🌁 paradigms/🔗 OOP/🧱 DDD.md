https://www.youtube.com/watch?v=JOy_SNK3qj4
### Принципы
##### Bound context
Логическое и физическое разбиение контекстов работы.
Например, если есть отдел продаж и отдел поддержки, а они в разных контекстах, то даже пользователи должны хранится в разных местах, при этом имея возможность синкаться между собой.
Например, первый контекст может создавать идентифицировать пользователя, а другой - давать ему отзывы и что-то еще.
##### Единый язык
Нужно, чтобы программисты и доменные эксперты использовали одну терминологию.
Актуализация и рефакторинг.
![[Pasted image 20250531211818.png|400]]
##### Фокус на доменной модели
Разработка начинается с доменной модели. А только после нее база данных и прочее.
Она в центре луковицы и не должна знать ничего за ее пределами.
### Виды моделей
**Инвариант** - логическое выражение, которое определяет непротиворечивость состояния. Например, если пользователь - сотрудник, то и почта у него от компании.
- **Богатые (rich)**
	- "инкапсулированная" модель - исключает возможность перехода в неконсистентное состояние
		- сокрытие информации и их группировка при работе
		- этот пункт является поддержкой консистентности
		- соблюдаются инварианты
- **Анемичные**
	- не накладывает ограничения на изменение атрибутов в классе (логических)
		- из-за чего существуют бОльшая вероятность ошибки из-за некорректного использования
	- *рефакторинг*
		- не использовать примитивные типы (например, email держать строкой или статусы, которые могут иметь только определенные значения) - нужно использовать так называемые `value objects`, т.е. обертки над базовыми типами
		- перевести логику из сервисов в `entities`. Сделать так, чтобы большинство операций с атрибутами модели были инкапсулированы, чтобы не забыть нужную логику в сервисах.
		  Таким образом инвариант проверяется самим классом.
### Изоляция доменной модели
Доменная модель не должна знать ничего про Application layer.
Она отвечает на вопрос "как?" что-то сделать, но не знает, "что?" нужно делать.
`Active Record` нарушает изоляцию, потому что в таком случае сама модель работает с сохранением + имеет зависимость от базы данных.
**Ссылочно-прозрачная зависимость** - когда при замене вызова функции ее результатом работы логика приложения поменяется. Такое встречается, когда внутри функции или класса есть зависимость, которая не передается, а используется сразу (например, получение текущего времени).
### DDD трилемма
Можно выбрать только два пункта из трех.
Чаще всего выбирается `изоляция+быстродействие`, потому что иначе доменная логика не будет изолирована от внешних зависимостей, либо сильно проиграет в быстродействии.
![[Pasted image 20250531220715.png]]